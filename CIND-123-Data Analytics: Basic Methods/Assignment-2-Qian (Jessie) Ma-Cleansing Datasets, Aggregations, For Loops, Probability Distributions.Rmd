---
title: 'CIND 123 - Data Analytics: Basic Methods'
author: 
output:
  word_document: default
  pdf_document: default
  html_document: default
---
<center> <h1> Assignment 2 (10%) </h1> </center>
<center> <h3> [Qian (Jessie) Ma] </h3> </center>
<center> <h3> [CIND 123 Section D40 & student number: 501274167] </h3> </center>
---

## Instructions 


This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. Review this website for more details on using R Markdown <http://rmarkdown.rstudio.com>.

Use RStudio for this assignment. Complete the assignment by inserting your R code wherever you see the string "#INSERT YOUR ANSWER HERE".

When you click the **Knit** button, a document (PDF, Word, or HTML format) will be generated that includes both the assignment content as well as the output of any embedded R code chunks.

Submit **both**  the rmd and generated output files. Failing to submit both files will be subject to mark deduction.

## Sample Question and Solution

Use `seq()` to create the vector $(100,97\ldots,4)$.

```{r}
seq(100, 3, -3)
```




## Question 1 (40 points)

The Titanic Passenger Survival Data Set provides information on the fate of passengers on the fatal maiden voyage of the ocean liner "Titanic." The dataset is available from the Department of Biostatistics at the Vanderbilt University School of Medicine (https://biostat.app.vumc.org/wiki/pub/Main/DataSets/titanic3.csv) in several formats. Store the Titanic Data Set `titanic_train` using the following commands. 


```{r}
#install.packages("titanic")
library(titanic)
titanicDataset <- read.csv(file = "https://biostat.app.vumc.org/wiki/pub/Main/DataSets/titanic3.csv", stringsAsFactors = F)
str(titanicDataset)
```

a) Extract and show the columns `cabin`, `age`, `embarked` and `pclass` into a new data frame of the name 'titanicSubset'. (5 points)

```{r}
#INSERT YOUR ANSWER HERE
titanicSubset<-titanicDataset[,c('cabin','age','embarked','pclass')]
head(titanicSubset)
```


b) Numerical data: Use the count() function from the `dplyr` package to display the total number of passengers that survived or not. (5 points) 
HINT: To count the occurrences of survived or not in the titanicDataset data frame using the `dplyr` package, you can use the pipe operator (%>%) to chain operations. 

```{r}
#INSERT YOUR ANSWER HERE
#install.packages("dplyr")
library(dplyr)
titanic_survival<-titanicDataset%>%
  count(survived)
titanic_survival
#As the dataset did not come with a data dictionary, I will assume that 0 means died and 1 means survived - therefore 809 passengers died and 500 survived based on the output.
```


c) Categorical data: Use count() and group_by() functions from the `dplyr` package to calculate the number of passengers by `embarked`. (5 points)
HINT: Use group_by() first then pipe the result to count() to calculate the number of passengers. 
```{r}
#INSERT YOUR ANSWER HERE
titanic_embarked<-titanicDataset%>% 
  group_by(embarked)%>% 
  count(embarked)
titanic_embarked
#The output shows the number of passengers that embarked from each gate.
```

d) Find the passengers in data frame whose embarked information is an empty character (""), and fill them by the most frequent embarked value. (3 points)

```{r}
#INSERT YOUR ANSWER HERE
#Find number of records with empty embarked information, in this case there are 2 rows, at indexes 169 and 285
titanic_emptyembarked<-subset(titanicDataset,embarked=="")
titanic_emptyembarked
#Find the most frequent embarked value, which in this case is "S"
sort(table(titanicDataset$embarked),decreasing=T)
#Fill in empty embarked information with "S" value
titanicDataset[c(169,285),'embarked']<-'S'
#Verify if the passenger embarked info is now filled
titanicDataset[c(169,285),]
#Verify that there are 2 additional passengers added to count of embarked 'S', you can see 2 were added to the previous count of 914, now the total is 916
titanic_embarked<-titanicDataset%>% 
  group_by(embarked)%>% 
  count(embarked)
titanic_embarked
```

e) Use the aggregate() function to calculate the 'survivalCount' of each `embarked` and calculate the survival rate of each embarked. Then draw the conclusion on which embarked has the higher survival rate. (5 points) 


```{r}
#INSERT YOUR ANSWER HERE
#Calculate survival count of each embarked
survivalCount<-aggregate(survived~embarked,data=titanicDataset,FUN=sum)
survivalCount
#Calculate survival rate of each embarked
survivalCount$survival_rate<-survivalCount$survived/table(titanicDataset$embarked)[survivalCount$embarked]*100
survivalCount
#It is concluded that embarkation gate letter "C" has the highest survival rate.
```


f) Use boxplot to display the distribution of fare for each pcalss and infer which passenger class is more expensive. (5 points)

```{r}
#INSERT YOUR ANSWER HERE
#Boxplot method 1
#install.packages("ggplot2")
library(ggplot2)
ggplot(data=titanicDataset,aes(x=as.factor(pclass),y=fare,fill=as.factor(pclass)))+
  geom_boxplot()+
  labs(x="Passenger Class",y="Paid Fare")+
  ggtitle("Distribution of Paid Fare For Each Passenger Class")+
  theme(plot.title=element_text(hjust=0.5))+
  scale_fill_discrete(name="Legend: pclass")
#Boxplot method 2
boxplot(fare~pclass,data=titanicDataset,main="Distribution of Paid Fare For Each Passenger Class",xlab="Passenger Class",ylab="Paid Fare",col=topo.colors((3)))
legend("topright",title="Legend: pclass",c("1","2","3"),fill=topo.colors(3))
#I can infer from the boxplots that Passenger Class 1 is more expensive than the rest because Q1, Q3, the median, upper whisker and highest outliers are all higher than their counterparts as displayed in the other passenger classes on the boxplots.
```


g) Calculate the average fare for three pclass and describe if the calculation agrees with the box plot. (5 points)

```{r}
#INSERT YOUR ANSWER HERE
average_fare<-titanicDataset%>%
  group_by(pclass)%>%
  summarize(average_fare=mean(fare))
average_fare
#As the boxplots do not display the mean, we can compare the output values to the median which is considered a type of average. Therefore, yes the calculation agrees with the boxplots because the values are very close to the median lines shown in the boxplot for the pclasses.
```


h) Use the for loop and if control statements to list the mens’s non-empty home destinations, age 54 or less that embarked from Q (Queenstown), on the Titanic. (7 points)

```{r}
#INSERT YOUR ANSWER HERE
#Display records with empty home destinations
titanic_emptyhomedest<-subset(titanicDataset,home.dest=="")
head(titanic_emptyhomedest)
#Assign NAs to empty values
titanicDataset[titanicDataset==""]<-NA
#Verify if there are still records with empty home destinations
nonemptyhomedest<-subset(titanicDataset,home.dest=="")
nonemptyhomedest
#List men's non-empty home destinations, age 54 or less embarking from Q
destinations<-c()
for (i in 1:nrow(titanicDataset)){
  if (!is.na(titanicDataset$age[i])&&
      !is.na(titanicDataset$sex[i])&&
      !is.na(titanicDataset$home.dest[i])&&
      titanicDataset$sex[i]=="male"&&
      titanicDataset$age[i]<=54&&
      titanicDataset$embarked[i]=="Q"){
    destinations<-c(destinations,titanicDataset$home.dest[i])
  }
}
print(unique(destinations))
```


## Question 2 (15 points)

80 engines work together in a sequence. The historical data shows that the probability of each engine’s failure is 0.05. We know that if one engine fails, the whole system stops.

a) What is the probability that the system operates without failure? (5 points)
```{r}
#INSERT YOUR ANSWER HERE
dbinom(x=80,size=80,prob=0.95)
```

b) Use the Binomial approximation to calculate the probability that at least 3 engines are defective? (5 points)
```{r}
#INSERT YOUR ANSWER HERE
1-pbinom(q=2,size=80,prob=0.05)
```

c) What is the probability that the second engine (B) is defective given the first engine (A) is not defective, i.e., P(B is defective|A is not defective), while we know that the first and second engines are independent. (5 points)
```{r}
#INSERT YOUR ANSWER HERE
#When events A and B are indepedent (where event A has no effect on the probability of event B), the conditional probability of event B given event A is simply the probability of event B or P(B). The probability of a defective engine is 0.05.
P_B<-0.05
p_B_given_A=P_B
p_B_given_A
```



## Question 3 (25 points)

On average, John visits his parents 4 times a month

a) Find the probabilities that John visits his parents 1 to 6 times in a month? (5 points)
```{r}
#INSERT YOUR ANSWER HERE
#Two ways to calculate the probability, first way:
ppois(6,lambda=4)-dpois(0,lambda=4)
#Second way:
sum(dpois(1:6,lambda=4))
```


b) Find the probability that John visits his parents 3 times or more in a month? (5 points)
```{r}
#INSERT YOUR ANSWER HERE
1-ppois(2,lambda=4)
```


c) Compare the similarity between Binomial and Poisson distribution. (15 points @ 5 point each)
1) Create 100,000 samples for a Binomial random variable using parameters described in Question 2
2) Create 100,000 samples for a Poisson random variable using parameters described in Question 3
3) then illustrate on how well the Poisson probability distribution approximates the Binomial probability distribution.
HINT: use multhist() from the 'plotrix' package
```{r}
#INSERT YOUR ANSWER HERE
#1) Binomial samples
binomial_samples<-rbinom(100000,80,0.05)
#binomial_samples
#2) Poisson samples
poisson_samples<-rpois(100000,4)
#poisson_samples
#3) Illustrate approximation: Binomial Distribution
hist(binomial_samples,col="violet",xlab="Samples",ylab="Frequency",main="Binomial Distribution")
#3) Illustrate approximation: Poisson Distribution
hist(poisson_samples,col="orange",xlab="Samples",ylab="Frequency",main="Poisson Distribution")
```
```{r}
#Combined histogram 1 using plotrix
#install.packages("plotrix")
library(plotrix)
multhist(list(binomial_samples,poisson_samples))

```



```{r}
#Combined histogram 2 using plotly
#install.packages("plotly")
library(plotly)
library(dplyr)
set.seed(123)

# Create Plotly figure with multiple histograms
fig <- plot_ly() %>%
  add_histogram(x = ~binomial_samples, name = "Binomial Samples", nbinsx = 30, opacity = 0.7) %>%
  add_histogram(x = ~poisson_samples, name = "Poisson Samples", nbinsx = 30, opacity = 0.7) %>%
  layout(title = "Comparing Distributions",
         xaxis = list(title = "Samples"),
         yaxis = list(title = "Frequency"))
fig
#From observing the individual histograms and combined histograms above it is very apparent that the Poisson probability distribution approximates the Binomial probability distribution very well. 
```

## Question 4 (20 points)

Write a script in R to compute the following probabilities of a normal random variable with mean 9 and variance 25

a) The probability that it lies between 8.2 and 17.3 (inclusive) (5 points)
```{r}
#INSERT YOUR ANSWER HERE
pnorm(17.3,mean=9,sd=sqrt(25))-pnorm(8.2,mean=9,sd=sqrt(25))
```


b) The probability that it is greater than 15.02 (5 points)
```{r}
#INSERT YOUR ANSWER HERE
1-pnorm(15.02,mean=9,sd=sqrt(25))
```


c) The probability that it is less than or equal to 11.8 (5 points)
```{r}
#INSERT YOUR ANSWER HERE
pnorm(11.8,mean=9,sd=sqrt(25))
```


d) The probability that it is less than 10 or greater than 13 (5 points)
```{r}
#INSERT YOUR ANSWER HERE
pnorm(10,mean=9,sd=sqrt(25))+(1-pnorm(13,mean=9,sd=sqrt(25)))
```


END of Assignment #2.